{"version":3,"sources":["vs/languages/html/common/fake","vs/languages/html/common/html.js","vs/languages/html/common/file:/home/aeschli/workspaces/vscode/src/vs/languages/html/common/htmlEmptyTagsShared.ts","vs/languages/html/common/file:/home/aeschli/workspaces/vscode/src/vs/languages/html/common/htmlTokenTypes.ts","vs/languages/html/common/file:/home/aeschli/workspaces/vscode/src/vs/languages/html/common/html.ts"],"names":["__m","__M","deps","result","i","len","length","define","require","exports","arrays","isEmptyElement","e","binarySearch","EMPTY_ELEMENTS","s1","s2","localeCompare","strings","isTag","tokenType","startsWith","TAG_PREFIX","getTag","name","DELIM_END","DELIM_START","DELIM_ASSIGN","ATTRIB_NAME","ATTRIB_VALUE","COMMENT","DELIM_COMMENT","DOCTYPE","DELIM_DOCTYPE","__extends","this","d","b","__","constructor","p","hasOwnProperty","prototype","Object","create","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","modes","abstractMode_1","abstractState_1","modeService_1","instantiation_1","htmlTokenTypes","htmlEmptyTagsShared_1","languageConfigurationRegistry_1","tokenizationSupport_1","async_1","compatWorkerService_1","States","tagsEmbeddingContent","State","_super","mode","kind","lastTagName","lastAttributeName","embeddedContentType","attributeValueQuote","attributeValue","call","escapeTagName","s","replace","makeClone","getMode","equals","other","nextElementName","stream","advanceIfRegExp","toLowerCase","nextAttributeName","tokenize","WithinComment","advanceUntilString2","type","advanceIfString2","Content","dontMergeWithPrev","WithinDoctype","advanceIfCharCode2","charCodeAt","eos","peek","advanceIfStringCaseInsensitive2","OpeningEndTag","OpeningStartTag","tagName","WithinTag","skipWhitespace2","AttributeName","indexOf","WithinEmbeddedContent","next2","AttributeValue","ch","part","next","advanceUntilString","unquote","value","start","end","substring","AbstractState","HTMLMode","descriptor","instantiationService","modeService","compatWorkerService","id","_modeWorkerManager","_createModeWorkerManager","tokenizationSupport","TokenizationSupport","configSupport","_registerSupports","_this","getId","Error","SuggestRegistry","register","triggerCharacters","shouldAutotriggerSuggest","provideCompletionItems","model","position","token","wireCancellationToken","_provideCompletionItems","uri","DocumentHighlightProviderRegistry","provideDocumentHighlights","_provideDocumentHighlights","DocumentRangeFormattingEditProviderRegistry","provideDocumentRangeFormattingEdits","range","options","_provideDocumentRangeFormattingEdits","LinkProviderRegistry","provideLinks","_provideLinks","LanguageConfigurationRegistry","LANG_CONFIG","ModeWorkerManager","_worker","runner","worker","getInitialState","enterNestedMode","state","getNestedMode","htmlState","missingModePromise","isRegisteredMode","getOrCreateMode","mimeType","getLeavingNestedModeData","line","regexp","RegExp","match","exec","nestedModeBuffer","index","bufferAfterNestedMode","stateAfterNestedMode","configure","isInMainThread","_configureWorker","w","_doConfigure","resource","strict","wordPattern","createWordRegExp","comments","blockComment","brackets","__electricCharacterSupport","embeddedElectricCharacters","autoClosingPairs","open","close","surroundingPairs","onEnterRules","beforeText","join","afterText","action","indentAction","IndentAction","IndentOutdent","Indent","$_configureWorker","CompatWorkerAttr","$_provideLinks","$_provideDocumentRangeFormattingEdits","$_provideDocumentHighlights","$_provideCompletionItems","IInstantiationService","IModeService","ICompatWorkerService","CompatMode"],"mappings":"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","file":"vs/languages/html/common/html.js","sourcesContent":["}).call(this);","/*!-----------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Version: 0.5.3(793ede49d53dba79d39e52205f16321278f5183c)\n * Released under the MIT license\n * https://github.com/Microsoft/vscode/blob/master/LICENSE.txt\n *-----------------------------------------------------------*/\n\n(function() {\nvar __m = [\"exports\",\"require\",\"vs/languages/html/common/htmlEmptyTagsShared\",\"vs/languages/html/common/htmlTokenTypes\",\"vs/editor/common/services/compatWorkerService\",\"vs/base/common/strings\",\"vs/languages/html/common/html\",\"vs/editor/common/modes\",\"vs/base/common/arrays\",\"vs/editor/common/modes/abstractState\",\"vs/editor/common/services/modeService\",\"vs/platform/instantiation/common/instantiation\",\"vs/editor/common/modes/languageConfigurationRegistry\",\"vs/editor/common/modes/supports/tokenizationSupport\",\"vs/base/common/async\",\"vs/editor/common/modes/abstractMode\"];\nvar __M = function(deps) {\n  var result = [];\n  for (var i = 0, len = deps.length; i < len; i++) {\n    result[i] = __m[deps[i]];\n  }\n  return result;\n};\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[2], __M([1,0,8]), function (require, exports, arrays) {\n    \"use strict\";\n    exports.EMPTY_ELEMENTS = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr'];\n    function isEmptyElement(e) {\n        return arrays.binarySearch(exports.EMPTY_ELEMENTS, e, function (s1, s2) { return s1.localeCompare(s2); }) >= 0;\n    }\n    exports.isEmptyElement = isEmptyElement;\n});\n\ndefine(__m[3], __M([1,0,5]), function (require, exports, strings) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.DELIM_END = 'punctuation.definition.meta.tag.end.html';\n    exports.DELIM_START = 'punctuation.definition.meta.tag.begin.html';\n    exports.DELIM_ASSIGN = 'meta.tag.assign.html';\n    exports.ATTRIB_NAME = 'entity.other.attribute-name.html';\n    exports.ATTRIB_VALUE = 'string.html';\n    exports.COMMENT = 'comment.html.content';\n    exports.DELIM_COMMENT = 'comment.html';\n    exports.DOCTYPE = 'entity.other.attribute-name.html';\n    exports.DELIM_DOCTYPE = 'entity.name.tag.html';\n    var TAG_PREFIX = 'entity.name.tag.tag-';\n    function isTag(tokenType) {\n        return strings.startsWith(tokenType, TAG_PREFIX);\n    }\n    exports.isTag = isTag;\n    function getTag(name) {\n        return TAG_PREFIX + name;\n    }\n    exports.getTag = getTag;\n});\n\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\ndefine(__m[6], __M([1,0,7,15,9,10,11,3,2,12,13,14,4]), function (require, exports, modes, abstractMode_1, abstractState_1, modeService_1, instantiation_1, htmlTokenTypes, htmlEmptyTagsShared_1, languageConfigurationRegistry_1, tokenizationSupport_1, async_1, compatWorkerService_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.htmlTokenTypes = htmlTokenTypes;\n    exports.EMPTY_ELEMENTS = htmlEmptyTagsShared_1.EMPTY_ELEMENTS;\n     // export to be used by Razor. We are the main module, so Razor should get it from us.\n     // export to be used by Razor. We are the main module, so Razor should get it from us.\n    (function (States) {\n        States[States[\"Content\"] = 0] = \"Content\";\n        States[States[\"OpeningStartTag\"] = 1] = \"OpeningStartTag\";\n        States[States[\"OpeningEndTag\"] = 2] = \"OpeningEndTag\";\n        States[States[\"WithinDoctype\"] = 3] = \"WithinDoctype\";\n        States[States[\"WithinTag\"] = 4] = \"WithinTag\";\n        States[States[\"WithinComment\"] = 5] = \"WithinComment\";\n        States[States[\"WithinEmbeddedContent\"] = 6] = \"WithinEmbeddedContent\";\n        States[States[\"AttributeName\"] = 7] = \"AttributeName\";\n        States[States[\"AttributeValue\"] = 8] = \"AttributeValue\";\n    })(exports.States || (exports.States = {}));\n    var States = exports.States;\n    // list of elements that embed other content\n    var tagsEmbeddingContent = ['script', 'style'];\n    var State = (function (_super) {\n        __extends(State, _super);\n        function State(mode, kind, lastTagName, lastAttributeName, embeddedContentType, attributeValueQuote, attributeValue) {\n            _super.call(this, mode);\n            this.kind = kind;\n            this.lastTagName = lastTagName;\n            this.lastAttributeName = lastAttributeName;\n            this.embeddedContentType = embeddedContentType;\n            this.attributeValueQuote = attributeValueQuote;\n            this.attributeValue = attributeValue;\n        }\n        State.escapeTagName = function (s) {\n            return htmlTokenTypes.getTag(s.replace(/[:_.]/g, '-'));\n        };\n        State.prototype.makeClone = function () {\n            return new State(this.getMode(), this.kind, this.lastTagName, this.lastAttributeName, this.embeddedContentType, this.attributeValueQuote, this.attributeValue);\n        };\n        State.prototype.equals = function (other) {\n            if (other instanceof State) {\n                return (_super.prototype.equals.call(this, other) &&\n                    this.kind === other.kind &&\n                    this.lastTagName === other.lastTagName &&\n                    this.lastAttributeName === other.lastAttributeName &&\n                    this.embeddedContentType === other.embeddedContentType &&\n                    this.attributeValueQuote === other.attributeValueQuote &&\n                    this.attributeValue === other.attributeValue);\n            }\n            return false;\n        };\n        State.prototype.nextElementName = function (stream) {\n            return stream.advanceIfRegExp(/^[_:\\w][_:\\w-.\\d]*/).toLowerCase();\n        };\n        State.prototype.nextAttributeName = function (stream) {\n            return stream.advanceIfRegExp(/^[^\\s\"'>/=\\x00-\\x0F\\x7F\\x80-\\x9F]*/).toLowerCase();\n        };\n        State.prototype.tokenize = function (stream) {\n            switch (this.kind) {\n                case States.WithinComment:\n                    if (stream.advanceUntilString2('-->', false)) {\n                        return { type: htmlTokenTypes.COMMENT };\n                    }\n                    else if (stream.advanceIfString2('-->')) {\n                        this.kind = States.Content;\n                        return { type: htmlTokenTypes.DELIM_COMMENT, dontMergeWithPrev: true };\n                    }\n                    break;\n                case States.WithinDoctype:\n                    if (stream.advanceUntilString2('>', false)) {\n                        return { type: htmlTokenTypes.DOCTYPE };\n                    }\n                    else if (stream.advanceIfString2('>')) {\n                        this.kind = States.Content;\n                        return { type: htmlTokenTypes.DELIM_DOCTYPE, dontMergeWithPrev: true };\n                    }\n                    break;\n                case States.Content:\n                    if (stream.advanceIfCharCode2('<'.charCodeAt(0))) {\n                        if (!stream.eos() && stream.peek() === '!') {\n                            if (stream.advanceIfString2('!--')) {\n                                this.kind = States.WithinComment;\n                                return { type: htmlTokenTypes.DELIM_COMMENT, dontMergeWithPrev: true };\n                            }\n                            if (stream.advanceIfStringCaseInsensitive2('!DOCTYPE')) {\n                                this.kind = States.WithinDoctype;\n                                return { type: htmlTokenTypes.DELIM_DOCTYPE, dontMergeWithPrev: true };\n                            }\n                        }\n                        if (stream.advanceIfCharCode2('/'.charCodeAt(0))) {\n                            this.kind = States.OpeningEndTag;\n                            return { type: htmlTokenTypes.DELIM_END, dontMergeWithPrev: true };\n                        }\n                        this.kind = States.OpeningStartTag;\n                        return { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n                    }\n                    break;\n                case States.OpeningEndTag:\n                    var tagName = this.nextElementName(stream);\n                    if (tagName.length > 0) {\n                        return {\n                            type: State.escapeTagName(tagName),\n                        };\n                    }\n                    else if (stream.advanceIfString2('>')) {\n                        this.kind = States.Content;\n                        return { type: htmlTokenTypes.DELIM_END, dontMergeWithPrev: true };\n                    }\n                    else {\n                        stream.advanceUntilString2('>', false);\n                        return { type: '' };\n                    }\n                case States.OpeningStartTag:\n                    this.lastTagName = this.nextElementName(stream);\n                    if (this.lastTagName.length > 0) {\n                        this.lastAttributeName = null;\n                        if ('script' === this.lastTagName || 'style' === this.lastTagName) {\n                            this.lastAttributeName = null;\n                            this.embeddedContentType = null;\n                        }\n                        this.kind = States.WithinTag;\n                        return {\n                            type: State.escapeTagName(this.lastTagName),\n                        };\n                    }\n                    break;\n                case States.WithinTag:\n                    if (stream.skipWhitespace2() || stream.eos()) {\n                        this.lastAttributeName = ''; // remember that we have seen a whitespace\n                        return { type: '' };\n                    }\n                    else {\n                        if (this.lastAttributeName === '') {\n                            var name = this.nextAttributeName(stream);\n                            if (name.length > 0) {\n                                this.lastAttributeName = name;\n                                this.kind = States.AttributeName;\n                                return { type: htmlTokenTypes.ATTRIB_NAME };\n                            }\n                        }\n                        if (stream.advanceIfString2('/>')) {\n                            this.kind = States.Content;\n                            return { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n                        }\n                        if (stream.advanceIfCharCode2('>'.charCodeAt(0))) {\n                            if (tagsEmbeddingContent.indexOf(this.lastTagName) !== -1) {\n                                this.kind = States.WithinEmbeddedContent;\n                                return { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n                            }\n                            else {\n                                this.kind = States.Content;\n                                return { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n                            }\n                        }\n                        else {\n                            stream.next2();\n                            return { type: '' };\n                        }\n                    }\n                case States.AttributeName:\n                    if (stream.skipWhitespace2() || stream.eos()) {\n                        return { type: '' };\n                    }\n                    if (stream.advanceIfCharCode2('='.charCodeAt(0))) {\n                        this.kind = States.AttributeValue;\n                        return { type: htmlTokenTypes.DELIM_ASSIGN };\n                    }\n                    else {\n                        this.kind = States.WithinTag;\n                        this.lastAttributeName = '';\n                        return this.tokenize(stream); // no advance yet - jump to WithinTag\n                    }\n                case States.AttributeValue:\n                    if (stream.eos()) {\n                        return { type: '' };\n                    }\n                    if (stream.skipWhitespace2()) {\n                        if (this.attributeValueQuote === '\"' || this.attributeValueQuote === '\\'') {\n                            // We are inside the quotes of an attribute value\n                            return { type: htmlTokenTypes.ATTRIB_VALUE };\n                        }\n                        return { type: '' };\n                    }\n                    // We are in a attribute value\n                    if (this.attributeValueQuote === '\"' || this.attributeValueQuote === '\\'') {\n                        if (this.attributeValue === this.attributeValueQuote && ('script' === this.lastTagName || 'style' === this.lastTagName) && 'type' === this.lastAttributeName) {\n                            this.attributeValue = stream.advanceUntilString(this.attributeValueQuote, true);\n                            if (this.attributeValue.length > 0) {\n                                this.embeddedContentType = this.unquote(this.attributeValue);\n                                this.kind = States.WithinTag;\n                                this.attributeValue = '';\n                                this.attributeValueQuote = '';\n                                return { type: htmlTokenTypes.ATTRIB_VALUE };\n                            }\n                        }\n                        else {\n                            if (stream.advanceIfCharCode2(this.attributeValueQuote.charCodeAt(0))) {\n                                this.kind = States.WithinTag;\n                                this.attributeValue = '';\n                                this.attributeValueQuote = '';\n                                this.lastAttributeName = null;\n                            }\n                            else {\n                                var part = stream.next();\n                                this.attributeValue += part;\n                            }\n                            return { type: htmlTokenTypes.ATTRIB_VALUE };\n                        }\n                    }\n                    else {\n                        var attributeValue = stream.advanceIfRegExp(/^[^\\s\"'`=<>]+/);\n                        if (attributeValue.length > 0) {\n                            this.kind = States.WithinTag;\n                            this.lastAttributeName = null;\n                            return { type: htmlTokenTypes.ATTRIB_VALUE };\n                        }\n                        var ch = stream.peek();\n                        if (ch === '\\'' || ch === '\"') {\n                            this.attributeValueQuote = ch;\n                            this.attributeValue = ch;\n                            stream.next2();\n                            return { type: htmlTokenTypes.ATTRIB_VALUE };\n                        }\n                        else {\n                            this.kind = States.WithinTag;\n                            this.lastAttributeName = null;\n                            return this.tokenize(stream); // no advance yet - jump to WithinTag\n                        }\n                    }\n            }\n            stream.next2();\n            this.kind = States.Content;\n            return { type: '' };\n        };\n        State.prototype.unquote = function (value) {\n            var start = 0;\n            var end = value.length;\n            if ('\"' === value[0]) {\n                start++;\n            }\n            if ('\"' === value[end - 1]) {\n                end--;\n            }\n            return value.substring(start, end);\n        };\n        return State;\n    }(abstractState_1.AbstractState));\n    exports.State = State;\n    var HTMLMode = (function (_super) {\n        __extends(HTMLMode, _super);\n        function HTMLMode(descriptor, instantiationService, modeService, compatWorkerService) {\n            _super.call(this, descriptor.id, compatWorkerService);\n            this._modeWorkerManager = this._createModeWorkerManager(descriptor, instantiationService);\n            this.modeService = modeService;\n            this.tokenizationSupport = new tokenizationSupport_1.TokenizationSupport(this, this, true);\n            this.configSupport = this;\n            this._registerSupports();\n        }\n        HTMLMode.prototype._registerSupports = function () {\n            var _this = this;\n            if (this.getId() !== 'html') {\n                throw new Error('This method must be overwritten!');\n            }\n            modes.SuggestRegistry.register(this.getId(), {\n                triggerCharacters: ['.', ':', '<', '\"', '=', '/'],\n                shouldAutotriggerSuggest: true,\n                provideCompletionItems: function (model, position, token) {\n                    return async_1.wireCancellationToken(token, _this._provideCompletionItems(model.uri, position));\n                }\n            }, true);\n            modes.DocumentHighlightProviderRegistry.register(this.getId(), {\n                provideDocumentHighlights: function (model, position, token) {\n                    return async_1.wireCancellationToken(token, _this._provideDocumentHighlights(model.uri, position));\n                }\n            }, true);\n            modes.DocumentRangeFormattingEditProviderRegistry.register(this.getId(), {\n                provideDocumentRangeFormattingEdits: function (model, range, options, token) {\n                    return async_1.wireCancellationToken(token, _this._provideDocumentRangeFormattingEdits(model.uri, range, options));\n                }\n            }, true);\n            modes.LinkProviderRegistry.register(this.getId(), {\n                provideLinks: function (model, token) {\n                    return async_1.wireCancellationToken(token, _this._provideLinks(model.uri));\n                }\n            }, true);\n            languageConfigurationRegistry_1.LanguageConfigurationRegistry.register(this.getId(), HTMLMode.LANG_CONFIG);\n        };\n        HTMLMode.prototype._createModeWorkerManager = function (descriptor, instantiationService) {\n            return new abstractMode_1.ModeWorkerManager(descriptor, 'vs/languages/html/common/htmlWorker', 'HTMLWorker', null, instantiationService);\n        };\n        HTMLMode.prototype._worker = function (runner) {\n            return this._modeWorkerManager.worker(runner);\n        };\n        // TokenizationSupport\n        HTMLMode.prototype.getInitialState = function () {\n            return new State(this, States.Content, '', '', '', '', '');\n        };\n        HTMLMode.prototype.enterNestedMode = function (state) {\n            return state instanceof State && state.kind === States.WithinEmbeddedContent;\n        };\n        HTMLMode.prototype.getNestedMode = function (state) {\n            var result = null;\n            var htmlState = state;\n            var missingModePromise = null;\n            if (htmlState.embeddedContentType !== null) {\n                if (this.modeService.isRegisteredMode(htmlState.embeddedContentType)) {\n                    result = this.modeService.getMode(htmlState.embeddedContentType);\n                    if (!result) {\n                        missingModePromise = this.modeService.getOrCreateMode(htmlState.embeddedContentType);\n                    }\n                }\n            }\n            else {\n                var mimeType = null;\n                if ('script' === htmlState.lastTagName) {\n                    mimeType = 'text/javascript';\n                }\n                else if ('style' === htmlState.lastTagName) {\n                    mimeType = 'text/css';\n                }\n                else {\n                    mimeType = 'text/plain';\n                }\n                result = this.modeService.getMode(mimeType);\n            }\n            if (result === null) {\n                result = this.modeService.getMode('text/plain');\n            }\n            return {\n                mode: result,\n                missingModePromise: missingModePromise\n            };\n        };\n        HTMLMode.prototype.getLeavingNestedModeData = function (line, state) {\n            var tagName = state.lastTagName;\n            var regexp = new RegExp('<\\\\/' + tagName + '\\\\s*>', 'i');\n            var match = regexp.exec(line);\n            if (match !== null) {\n                return {\n                    nestedModeBuffer: line.substring(0, match.index),\n                    bufferAfterNestedMode: line.substring(match.index),\n                    stateAfterNestedMode: new State(this, States.Content, '', '', '', '', '')\n                };\n            }\n            return null;\n        };\n        HTMLMode.prototype.configure = function (options) {\n            if (!this.compatWorkerService) {\n                return;\n            }\n            if (this.compatWorkerService.isInMainThread) {\n                return this._configureWorker(options);\n            }\n            else {\n                return this._worker(function (w) { return w._doConfigure(options); });\n            }\n        };\n        HTMLMode.prototype._configureWorker = function (options) {\n            return this._worker(function (w) { return w._doConfigure(options); });\n        };\n        HTMLMode.prototype._provideLinks = function (resource) {\n            return this._worker(function (w) { return w.provideLinks(resource); });\n        };\n        HTMLMode.prototype._provideDocumentRangeFormattingEdits = function (resource, range, options) {\n            return this._worker(function (w) { return w.provideDocumentRangeFormattingEdits(resource, range, options); });\n        };\n        HTMLMode.prototype._provideDocumentHighlights = function (resource, position, strict) {\n            if (strict === void 0) { strict = false; }\n            return this._worker(function (w) { return w.provideDocumentHighlights(resource, position, strict); });\n        };\n        HTMLMode.prototype._provideCompletionItems = function (resource, position) {\n            return this._worker(function (w) { return w.provideCompletionItems(resource, position); });\n        };\n        HTMLMode.LANG_CONFIG = {\n            wordPattern: abstractMode_1.createWordRegExp('#-?%'),\n            comments: {\n                blockComment: ['<!--', '-->']\n            },\n            brackets: [\n                ['<!--', '-->'],\n                ['<', '>'],\n            ],\n            __electricCharacterSupport: {\n                embeddedElectricCharacters: ['*', '}', ']', ')']\n            },\n            autoClosingPairs: [\n                { open: '{', close: '}' },\n                { open: '[', close: ']' },\n                { open: '(', close: ')' },\n                { open: '\"', close: '\"' },\n                { open: '\\'', close: '\\'' }\n            ],\n            surroundingPairs: [\n                { open: '\"', close: '\"' },\n                { open: '\\'', close: '\\'' }\n            ],\n            onEnterRules: [\n                {\n                    beforeText: new RegExp(\"<(?!(?:\" + htmlEmptyTagsShared_1.EMPTY_ELEMENTS.join('|') + \"))([_:\\\\w][_:\\\\w-.\\\\d]*)([^/>]*(?!/)>)[^<]*$\", 'i'),\n                    afterText: /^<\\/([_:\\w][_:\\w-.\\d]*)\\s*>$/i,\n                    action: { indentAction: modes.IndentAction.IndentOutdent }\n                },\n                {\n                    beforeText: new RegExp(\"<(?!(?:\" + htmlEmptyTagsShared_1.EMPTY_ELEMENTS.join('|') + \"))(\\\\w[\\\\w\\\\d]*)([^/>]*(?!/)>)[^<]*$\", 'i'),\n                    action: { indentAction: modes.IndentAction.Indent }\n                }\n            ],\n        };\n        HTMLMode.$_configureWorker = compatWorkerService_1.CompatWorkerAttr(HTMLMode, HTMLMode.prototype._configureWorker);\n        HTMLMode.$_provideLinks = compatWorkerService_1.CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideLinks);\n        HTMLMode.$_provideDocumentRangeFormattingEdits = compatWorkerService_1.CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideDocumentRangeFormattingEdits);\n        HTMLMode.$_provideDocumentHighlights = compatWorkerService_1.CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideDocumentHighlights);\n        HTMLMode.$_provideCompletionItems = compatWorkerService_1.CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideCompletionItems);\n        HTMLMode = __decorate([\n            __param(1, instantiation_1.IInstantiationService),\n            __param(2, modeService_1.IModeService),\n            __param(3, compatWorkerService_1.ICompatWorkerService)\n        ], HTMLMode);\n        return HTMLMode;\n    }(abstractMode_1.CompatMode));\n    exports.HTMLMode = HTMLMode;\n});\n\n}).call(this);\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport arrays = require('vs/base/common/arrays');\n\nexport const EMPTY_ELEMENTS:string[] = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr'];\n\nexport function isEmptyElement(e: string) : boolean {\n\treturn arrays.binarySearch(EMPTY_ELEMENTS, e,(s1: string, s2: string) => s1.localeCompare(s2)) >= 0;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport strings = require('vs/base/common/strings');\n\nexport const DELIM_END = 'punctuation.definition.meta.tag.end.html';\nexport const DELIM_START = 'punctuation.definition.meta.tag.begin.html';\nexport const DELIM_ASSIGN = 'meta.tag.assign.html';\nexport const ATTRIB_NAME = 'entity.other.attribute-name.html';\nexport const ATTRIB_VALUE = 'string.html';\nexport const COMMENT = 'comment.html.content';\nexport const DELIM_COMMENT = 'comment.html';\nexport const DOCTYPE = 'entity.other.attribute-name.html';\nexport const DELIM_DOCTYPE = 'entity.name.tag.html';\n\nconst TAG_PREFIX = 'entity.name.tag.tag-';\n\nexport function isTag(tokenType: string) {\n\treturn strings.startsWith(tokenType, TAG_PREFIX);\n}\n\nexport function getTag(name: string) {\n\treturn TAG_PREFIX + name;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport winjs = require('vs/base/common/winjs.base');\nimport editorCommon = require('vs/editor/common/editorCommon');\nimport modes = require('vs/editor/common/modes');\nimport htmlWorker = require('vs/languages/html/common/htmlWorker');\nimport { CompatMode, createWordRegExp, ModeWorkerManager } from 'vs/editor/common/modes/abstractMode';\nimport { AbstractState } from 'vs/editor/common/modes/abstractState';\nimport {IModeService} from 'vs/editor/common/services/modeService';\nimport {IInstantiationService} from 'vs/platform/instantiation/common/instantiation';\nimport * as htmlTokenTypes from 'vs/languages/html/common/htmlTokenTypes';\nimport {EMPTY_ELEMENTS} from 'vs/languages/html/common/htmlEmptyTagsShared';\nimport {LanguageConfigurationRegistry, LanguageConfiguration} from 'vs/editor/common/modes/languageConfigurationRegistry';\nimport {TokenizationSupport, IEnteringNestedModeData, ILeavingNestedModeData, ITokenizationCustomization} from 'vs/editor/common/modes/supports/tokenizationSupport';\nimport {wireCancellationToken} from 'vs/base/common/async';\nimport {ICompatWorkerService, CompatWorkerAttr} from 'vs/editor/common/services/compatWorkerService';\n\nexport { htmlTokenTypes }; // export to be used by Razor. We are the main module, so Razor should get it from us.\nexport { EMPTY_ELEMENTS }; // export to be used by Razor. We are the main module, so Razor should get it from us.\n\nexport enum States {\n\tContent,\n\tOpeningStartTag,\n\tOpeningEndTag,\n\tWithinDoctype,\n\tWithinTag,\n\tWithinComment,\n\tWithinEmbeddedContent,\n\tAttributeName,\n\tAttributeValue\n}\n\n// list of elements that embed other content\nvar tagsEmbeddingContent:string[] = ['script', 'style'];\n\n\n\nexport class State extends AbstractState {\n\tpublic kind:States;\n\tpublic lastTagName:string;\n\tpublic lastAttributeName:string;\n\tpublic embeddedContentType:string;\n\tpublic attributeValueQuote:string;\n\tpublic attributeValue:string;\n\n\tconstructor(mode:modes.IMode, kind:States, lastTagName:string, lastAttributeName:string, embeddedContentType:string, attributeValueQuote:string, attributeValue:string) {\n\t\tsuper(mode);\n\t\tthis.kind = kind;\n\t\tthis.lastTagName = lastTagName;\n\t\tthis.lastAttributeName = lastAttributeName;\n\t\tthis.embeddedContentType = embeddedContentType;\n\t\tthis.attributeValueQuote = attributeValueQuote;\n\t\tthis.attributeValue = attributeValue;\n\t}\n\n\tstatic escapeTagName(s:string):string {\n\t\treturn htmlTokenTypes.getTag(s.replace(/[:_.]/g, '-'));\n\t}\n\n\tpublic makeClone():State {\n\t\treturn new State(this.getMode(), this.kind, this.lastTagName, this.lastAttributeName, this.embeddedContentType, this.attributeValueQuote, this.attributeValue);\n\t}\n\n\tpublic equals(other:modes.IState):boolean {\n\t\tif (other instanceof State) {\n\t\t\treturn (\n\t\t\t\tsuper.equals(other) &&\n\t\t\t\tthis.kind === other.kind &&\n\t\t\t\tthis.lastTagName === other.lastTagName &&\n\t\t\t\tthis.lastAttributeName === other.lastAttributeName &&\n\t\t\t\tthis.embeddedContentType === other.embeddedContentType &&\n\t\t\t\tthis.attributeValueQuote === other.attributeValueQuote &&\n\t\t\t\tthis.attributeValue === other.attributeValue\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate nextElementName(stream:modes.IStream):string {\n\t\treturn stream.advanceIfRegExp(/^[_:\\w][_:\\w-.\\d]*/).toLowerCase();\n\t}\n\n\tprivate nextAttributeName(stream:modes.IStream):string {\n\t\treturn stream.advanceIfRegExp(/^[^\\s\"'>/=\\x00-\\x0F\\x7F\\x80-\\x9F]*/).toLowerCase();\n\t}\n\n\tpublic tokenize(stream:modes.IStream) : modes.ITokenizationResult {\n\n\t\tswitch(this.kind){\n\t\t\tcase States.WithinComment:\n\t\t\t\tif (stream.advanceUntilString2('-->', false)) {\n\t\t\t\t\treturn { type: htmlTokenTypes.COMMENT};\n\n\t\t\t\t} else if(stream.advanceIfString2('-->')) {\n\t\t\t\t\tthis.kind = States.Content;\n\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_COMMENT, dontMergeWithPrev: true };\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase States.WithinDoctype:\n\t\t\t\tif (stream.advanceUntilString2('>', false)) {\n\t\t\t\t\treturn { type: htmlTokenTypes.DOCTYPE};\n\t\t\t\t} else if(stream.advanceIfString2('>')) {\n\t\t\t\t\tthis.kind = States.Content;\n\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_DOCTYPE, dontMergeWithPrev: true };\n\t\t\t\t}\n\t\t\tbreak;\n\n\t\t\tcase States.Content:\n\t\t\t\tif (stream.advanceIfCharCode2('<'.charCodeAt(0))) {\n\t\t\t\t\tif (!stream.eos() && stream.peek() === '!') {\n\t\t\t\t\t\tif (stream.advanceIfString2('!--')) {\n\t\t\t\t\t\t\tthis.kind = States.WithinComment;\n\t\t\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_COMMENT, dontMergeWithPrev: true };\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (stream.advanceIfStringCaseInsensitive2('!DOCTYPE')) {\n\t\t\t\t\t\t\tthis.kind = States.WithinDoctype;\n\t\t\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_DOCTYPE, dontMergeWithPrev: true };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.advanceIfCharCode2('/'.charCodeAt(0))) {\n\t\t\t\t\t\tthis.kind = States.OpeningEndTag;\n\t\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_END, dontMergeWithPrev: true };\n\t\t\t\t\t}\n\t\t\t\t\tthis.kind = States.OpeningStartTag;\n\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase States.OpeningEndTag:\n\t\t\t\tvar tagName = this.nextElementName(stream);\n\t\t\t\tif (tagName.length > 0){\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: State.escapeTagName(tagName),\n\t\t\t\t\t};\n\n\t\t\t\t} else if (stream.advanceIfString2('>')) {\n\t\t\t\t\tthis.kind = States.Content;\n\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_END, dontMergeWithPrev: true };\n\n\t\t\t\t} else {\n\t\t\t\t\tstream.advanceUntilString2('>', false);\n\t\t\t\t\treturn { type: '' };\n\t\t\t\t}\n\n\t\t\tcase States.OpeningStartTag:\n\t\t\t\tthis.lastTagName = this.nextElementName(stream);\n\t\t\t\tif (this.lastTagName.length > 0) {\n\t\t\t\t\tthis.lastAttributeName = null;\n\t\t\t\t\tif ('script' === this.lastTagName || 'style' === this.lastTagName) {\n\t\t\t\t\t\tthis.lastAttributeName = null;\n\t\t\t\t\t\tthis.embeddedContentType = null;\n\t\t\t\t\t}\n\t\t\t\t\tthis.kind = States.WithinTag;\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: State.escapeTagName(this.lastTagName),\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase States.WithinTag:\n\t\t\t\tif (stream.skipWhitespace2() || stream.eos()) {\n\t\t\t\t\tthis.lastAttributeName = ''; // remember that we have seen a whitespace\n\t\t\t\t\treturn { type: '' };\n\t\t\t\t} else {\n\t\t\t\t\tif (this.lastAttributeName === '') {\n\t\t\t\t\t\tvar name = this.nextAttributeName(stream);\n\t\t\t\t\t\tif (name.length > 0) {\n\t\t\t\t\t\t\tthis.lastAttributeName = name;\n\t\t\t\t\t\t\tthis.kind = States.AttributeName;\n\t\t\t\t\t\t\treturn { type: htmlTokenTypes.ATTRIB_NAME };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.advanceIfString2('/>')) {\n\t\t\t\t\t\tthis.kind = States.Content;\n\t\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n\t\t\t\t\t}\n\t\t\t\t\tif (stream.advanceIfCharCode2('>'.charCodeAt(0))) {\n\t\t\t\t\t\tif (tagsEmbeddingContent.indexOf(this.lastTagName) !== -1) {\n\t\t\t\t\t\t\tthis.kind = States.WithinEmbeddedContent;\n\t\t\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.kind = States.Content;\n\t\t\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_START, dontMergeWithPrev: true };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstream.next2();\n\t\t\t\t\t\treturn { type: '' };\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\tcase States.AttributeName:\n\t\t\t\tif (stream.skipWhitespace2() || stream.eos()){\n\t\t\t\t\treturn { type: '' };\n\t\t\t\t}\n\n\t\t\t\tif (stream.advanceIfCharCode2('='.charCodeAt(0))) {\n\t\t\t\t\tthis.kind = States.AttributeValue;\n\t\t\t\t\treturn { type: htmlTokenTypes.DELIM_ASSIGN };\n\t\t\t\t} else {\n\t\t\t\t\tthis.kind = States.WithinTag;\n\t\t\t\t\tthis.lastAttributeName = '';\n\t\t\t\t\treturn this.tokenize(stream); // no advance yet - jump to WithinTag\n\t\t\t\t}\n\n\t\t\tcase States.AttributeValue:\n\t\t\t\tif (stream.eos()) {\n\t\t\t\t\treturn { type: '' };\n\t\t\t\t}\n\t\t\t\tif(stream.skipWhitespace2()) {\n\t\t\t\t\tif (this.attributeValueQuote === '\"' || this.attributeValueQuote === '\\'') {\n\t\t\t\t\t\t// We are inside the quotes of an attribute value\n\t\t\t\t\t\treturn { type: htmlTokenTypes.ATTRIB_VALUE };\n\t\t\t\t\t}\n\t\t\t\t\treturn { type: '' };\n\t\t\t\t}\n\t\t\t\t// We are in a attribute value\n\t\t\t\tif (this.attributeValueQuote === '\"' || this.attributeValueQuote === '\\'') {\n\n\t\t\t\t\tif (this.attributeValue === this.attributeValueQuote && ('script' === this.lastTagName || 'style' === this.lastTagName) && 'type' === this.lastAttributeName) {\n\t\t\t\t\t\tthis.attributeValue = stream.advanceUntilString(this.attributeValueQuote, true);\n\t\t\t\t\t\tif (this.attributeValue.length > 0) {\n\t\t\t\t\t\t\tthis.embeddedContentType = this.unquote(this.attributeValue);\n\t\t\t\t\t\t\tthis.kind = States.WithinTag;\n\t\t\t\t\t\t\tthis.attributeValue = '';\n\t\t\t\t\t\t\tthis.attributeValueQuote = '';\n\t\t\t\t\t\t\treturn { type: htmlTokenTypes.ATTRIB_VALUE };\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (stream.advanceIfCharCode2(this.attributeValueQuote.charCodeAt(0))) {\n\t\t\t\t\t\t\tthis.kind = States.WithinTag;\n\t\t\t\t\t\t\tthis.attributeValue = '';\n\t\t\t\t\t\t\tthis.attributeValueQuote = '';\n\t\t\t\t\t\t\tthis.lastAttributeName = null;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar part = stream.next();\n\t\t\t\t\t\t\tthis.attributeValue += part;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn { type: htmlTokenTypes.ATTRIB_VALUE };\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet attributeValue = stream.advanceIfRegExp(/^[^\\s\"'`=<>]+/);\n\t\t\t\t\tif (attributeValue.length > 0) {\n\t\t\t\t\t\tthis.kind = States.WithinTag;\n\t\t\t\t\t\tthis.lastAttributeName = null;\n\t\t\t\t\t\treturn { type: htmlTokenTypes.ATTRIB_VALUE };\n\t\t\t\t\t}\n\t\t\t\t\tvar ch = stream.peek();\n\t\t\t\t\tif (ch === '\\'' || ch === '\"') {\n\t\t\t\t\t\tthis.attributeValueQuote = ch;\n\t\t\t\t\t\tthis.attributeValue = ch;\n\t\t\t\t\t\tstream.next2();\n\t\t\t\t\t\treturn { type: htmlTokenTypes.ATTRIB_VALUE };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.kind = States.WithinTag;\n\t\t\t\t\t\tthis.lastAttributeName = null;\n\t\t\t\t\t\treturn this.tokenize(stream); // no advance yet - jump to WithinTag\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\tstream.next2();\n\t\tthis.kind = States.Content;\n\t\treturn { type: '' };\n\t}\n\n\tprivate unquote(value:string):string {\n\t\tvar start = 0;\n\t\tvar end = value.length;\n\t\tif ('\"' === value[0]) {\n\t\t\tstart++;\n\t\t}\n\t\tif ('\"' === value[end - 1]) {\n\t\t\tend--;\n\t\t}\n\t\treturn value.substring(start, end);\n\t}\n}\n\nexport class HTMLMode<W extends htmlWorker.HTMLWorker> extends CompatMode implements ITokenizationCustomization {\n\n\tpublic static LANG_CONFIG:LanguageConfiguration = {\n\t\twordPattern: createWordRegExp('#-?%'),\n\n\t\tcomments: {\n\t\t\tblockComment: ['<!--', '-->']\n\t\t},\n\n\t\tbrackets: [\n\t\t\t['<!--', '-->'],\n\t\t\t['<', '>'],\n\t\t],\n\n\t\t__electricCharacterSupport: {\n\t\t\tembeddedElectricCharacters: ['*', '}', ']', ')']\n\t\t},\n\n\t\tautoClosingPairs: [\n\t\t\t{ open: '{', close: '}' },\n\t\t\t{ open: '[', close: ']' },\n\t\t\t{ open: '(', close: ')' },\n\t\t\t{ open: '\"', close: '\"' },\n\t\t\t{ open: '\\'', close: '\\'' }\n\t\t],\n\n\t\tsurroundingPairs: [\n\t\t\t{ open: '\"', close: '\"' },\n\t\t\t{ open: '\\'', close: '\\'' }\n\t\t],\n\n\t\tonEnterRules: [\n\t\t\t{\n\t\t\t\tbeforeText: new RegExp(`<(?!(?:${EMPTY_ELEMENTS.join('|')}))([_:\\\\w][_:\\\\w-.\\\\d]*)([^/>]*(?!/)>)[^<]*$`, 'i'),\n\t\t\t\tafterText: /^<\\/([_:\\w][_:\\w-.\\d]*)\\s*>$/i,\n\t\t\t\taction: { indentAction: modes.IndentAction.IndentOutdent }\n\t\t\t},\n\t\t\t{\n\t\t\t\tbeforeText: new RegExp(`<(?!(?:${EMPTY_ELEMENTS.join('|')}))(\\\\w[\\\\w\\\\d]*)([^/>]*(?!/)>)[^<]*$`, 'i'),\n\t\t\t\taction: { indentAction: modes.IndentAction.Indent }\n\t\t\t}\n\t\t],\n\t};\n\n\tpublic tokenizationSupport: modes.ITokenizationSupport;\n\tpublic configSupport: modes.IConfigurationSupport;\n\n\tprivate modeService:IModeService;\n\tprivate _modeWorkerManager: ModeWorkerManager<W>;\n\n\tconstructor(\n\t\tdescriptor:modes.IModeDescriptor,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IModeService modeService: IModeService,\n\t\t@ICompatWorkerService compatWorkerService: ICompatWorkerService\n\t) {\n\t\tsuper(descriptor.id, compatWorkerService);\n\t\tthis._modeWorkerManager = this._createModeWorkerManager(descriptor, instantiationService);\n\n\t\tthis.modeService = modeService;\n\n\t\tthis.tokenizationSupport = new TokenizationSupport(this, this, true);\n\t\tthis.configSupport = this;\n\n\t\tthis._registerSupports();\n\t}\n\n\tprotected _registerSupports(): void {\n\t\tif (this.getId() !== 'html') {\n\t\t\tthrow new Error('This method must be overwritten!');\n\t\t}\n\n\t\tmodes.SuggestRegistry.register(this.getId(), {\n\t\t\ttriggerCharacters: ['.', ':', '<', '\"', '=', '/'],\n\t\t\tshouldAutotriggerSuggest: true,\n\t\t\tprovideCompletionItems: (model, position, token): Thenable<modes.ISuggestResult[]> => {\n\t\t\t\treturn wireCancellationToken(token, this._provideCompletionItems(model.uri, position));\n\t\t\t}\n\t\t}, true);\n\n\t\tmodes.DocumentHighlightProviderRegistry.register(this.getId(), {\n\t\t\tprovideDocumentHighlights: (model, position, token): Thenable<modes.DocumentHighlight[]> => {\n\t\t\t\treturn wireCancellationToken(token, this._provideDocumentHighlights(model.uri, position));\n\t\t\t}\n\t\t}, true);\n\n\t\tmodes.DocumentRangeFormattingEditProviderRegistry.register(this.getId(), {\n\t\t\tprovideDocumentRangeFormattingEdits: (model, range, options, token): Thenable<editorCommon.ISingleEditOperation[]> => {\n\t\t\t\treturn wireCancellationToken(token, this._provideDocumentRangeFormattingEdits(model.uri, range, options));\n\t\t\t}\n\t\t}, true);\n\n\t\tmodes.LinkProviderRegistry.register(this.getId(), {\n\t\t\tprovideLinks: (model, token): Thenable<modes.ILink[]> => {\n\t\t\t\treturn wireCancellationToken(token, this._provideLinks(model.uri));\n\t\t\t}\n\t\t}, true);\n\n\t\tLanguageConfigurationRegistry.register(this.getId(), HTMLMode.LANG_CONFIG);\n\t}\n\n\tprotected _createModeWorkerManager(descriptor:modes.IModeDescriptor, instantiationService: IInstantiationService): ModeWorkerManager<W> {\n\t\treturn new ModeWorkerManager<W>(descriptor, 'vs/languages/html/common/htmlWorker', 'HTMLWorker', null, instantiationService);\n\t}\n\n\tprivate _worker<T>(runner:(worker:W)=>winjs.TPromise<T>): winjs.TPromise<T> {\n\t\treturn this._modeWorkerManager.worker(runner);\n\t}\n\n\t// TokenizationSupport\n\n\tpublic getInitialState():modes.IState {\n\t\treturn new State(this, States.Content, '', '', '', '', '');\n\t}\n\n\tpublic enterNestedMode(state:modes.IState):boolean {\n\t\treturn state instanceof State && (<State>state).kind === States.WithinEmbeddedContent;\n\t}\n\n\tpublic getNestedMode(state:modes.IState): IEnteringNestedModeData {\n\t\tvar result:modes.IMode = null;\n\t\tvar htmlState:State = <State>state;\n\t\tvar missingModePromise: winjs.Promise = null;\n\n\t\tif (htmlState.embeddedContentType !== null) {\n\t\t\tif (this.modeService.isRegisteredMode(htmlState.embeddedContentType)) {\n\t\t\t\tresult = this.modeService.getMode(htmlState.embeddedContentType);\n\t\t\t\tif (!result) {\n\t\t\t\t\tmissingModePromise = this.modeService.getOrCreateMode(htmlState.embeddedContentType);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tvar mimeType:string = null;\n\t\t\tif ('script' === htmlState.lastTagName) {\n\t\t\t\tmimeType = 'text/javascript';\n\t\t\t} else if ('style' === htmlState.lastTagName) {\n\t\t\t\tmimeType = 'text/css';\n\t\t\t} else {\n\t\t\t\tmimeType = 'text/plain';\n\t\t\t}\n\t\t\tresult = this.modeService.getMode(mimeType);\n\t\t}\n\t\tif (result === null) {\n\t\t\tresult = this.modeService.getMode('text/plain');\n\t\t}\n\t\treturn {\n\t\t\tmode: result,\n\t\t\tmissingModePromise: missingModePromise\n\t\t};\n\t}\n\n\tpublic getLeavingNestedModeData(line:string, state:modes.IState):ILeavingNestedModeData {\n\t\tvar tagName = (<State>state).lastTagName;\n\t\tvar regexp = new RegExp('<\\\\/' + tagName + '\\\\s*>', 'i');\n\t\tvar match:any = regexp.exec(line);\n\t\tif (match !== null) {\n\t\t\treturn {\n\t\t\t\tnestedModeBuffer: line.substring(0, match.index),\n\t\t\t\tbufferAfterNestedMode: line.substring(match.index),\n\t\t\t\tstateAfterNestedMode: new State(this, States.Content, '', '', '', '', '')\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic configure(options:any): winjs.TPromise<void> {\n\t\tif (!this.compatWorkerService) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.compatWorkerService.isInMainThread) {\n\t\t\treturn this._configureWorker(options);\n\t\t} else {\n\t\t\treturn this._worker((w) => w._doConfigure(options));\n\t\t}\n\t}\n\n\tstatic $_configureWorker = CompatWorkerAttr(HTMLMode, HTMLMode.prototype._configureWorker);\n\tprivate _configureWorker(options:any): winjs.TPromise<void> {\n\t\treturn this._worker((w) => w._doConfigure(options));\n\t}\n\n\tstatic $_provideLinks = CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideLinks);\n\tprotected _provideLinks(resource:URI):winjs.TPromise<modes.ILink[]> {\n\t\treturn this._worker((w) => w.provideLinks(resource));\n\t}\n\n\tstatic $_provideDocumentRangeFormattingEdits = CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideDocumentRangeFormattingEdits);\n\tprivate _provideDocumentRangeFormattingEdits(resource:URI, range:editorCommon.IRange, options:modes.FormattingOptions):winjs.TPromise<editorCommon.ISingleEditOperation[]> {\n\t\treturn this._worker((w) => w.provideDocumentRangeFormattingEdits(resource, range, options));\n\t}\n\n\tstatic $_provideDocumentHighlights = CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideDocumentHighlights);\n\tprotected _provideDocumentHighlights(resource:URI, position:editorCommon.IPosition, strict:boolean = false): winjs.TPromise<modes.DocumentHighlight[]> {\n\t\treturn this._worker((w) => w.provideDocumentHighlights(resource, position, strict));\n\t}\n\n\tstatic $_provideCompletionItems = CompatWorkerAttr(HTMLMode, HTMLMode.prototype._provideCompletionItems);\n\tprotected _provideCompletionItems(resource:URI, position:editorCommon.IPosition):winjs.TPromise<modes.ISuggestResult[]> {\n\t\treturn this._worker((w) => w.provideCompletionItems(resource, position));\n\t}\n\n}\n"]}